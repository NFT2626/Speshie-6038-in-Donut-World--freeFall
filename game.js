/*! Built with IMPACT - impactjs.com */

!function(t){"use strict";if(Number.prototype.map=function(t,i,e,s){return e+(this-t)/(i-t)*(s-e)},Number.prototype.limit=function(t,i){return Math.min(i,Math.max(t,this))},Number.prototype.round=function(t){return t=Math.pow(10,t||0),Math.round(this*t)/t},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return 0|this},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return 180*this/Math.PI},Object.defineProperty(Array.prototype,"erase",{value:function(t){for(var i=this.length;i--;)this[i]===t&&this.splice(i,1);return this}}),Object.defineProperty(Array.prototype,"random",{value:function(t){return this[Math.floor(Math.random()*this.length)]}}),Function.prototype.bind=Function.prototype.bind||function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),e=this,s=function(){},n=function(){return e.apply(this instanceof s&&t?this:t,i.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,n.prototype=new s,n},t.ig={game:null,debug:null,version:"1.24",global:t,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:t.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(t){return"#"==t.charAt(0)?document.getElementById(t.substr(1)):document.getElementsByTagName(t)},$new:function(t){return document.createElement(t)},copy:function(t){if(!t||"object"!=typeof t||t instanceof HTMLElement||t instanceof ig.Class)return t;if(t instanceof Array){for(var i=[],e=0,s=t.length;e<s;e++)i[e]=ig.copy(t[e]);return i}var i={};for(var e in t)i[e]=ig.copy(t[e]);return i},merge:function(t,i){for(var e in i){var s=i[e];"object"!=typeof s||s instanceof HTMLElement||s instanceof ig.Class||null===s?t[e]=s:(t[e]&&"object"==typeof t[e]||(t[e]=s instanceof Array?[]:{}),ig.merge(t[e],s))}return t},ksort:function(t){if(!t||"object"!=typeof t)return[];var i=[],e=[];for(var s in t)i.push(s);i.sort();for(var s=0;s<i.length;s++)e.push(t[i[s]]);return e},setVendorAttribute:function(t,i,e){var s=i.charAt(0).toUpperCase()+i.substr(1);t[i]=t["ms"+s]=t["moz"+s]=t["webkit"+s]=t["o"+s]=e},getVendorAttribute:function(t,i){var e=i.charAt(0).toUpperCase()+i.substr(1);return t[i]||t["ms"+e]||t["moz"+e]||t["webkit"+e]||t["o"+e]},normalizeVendorAttribute:function(t,i){var e=ig.getVendorAttribute(t,i);!t[i]&&e&&(t[i]=e)},getImagePixels:function(t,i,e,s,n){var a=ig.$new("canvas");a.width=t.width,a.height=t.height;var o=a.getContext("2d");ig.System.SCALE.CRISP(a,o);var h=ig.getVendorAttribute(o,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(o,"getImageDataHD");var r=t.width/h,l=t.height/h;return a.width=Math.ceil(r),a.height=Math.ceil(l),o.drawImage(t,0,0,r,l),1===h?o.getImageData(i,e,s,n):o.getImageDataHD(i,e,s,n)},module:function(t){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[t]&&ig.modules[t].body)throw"Module '"+t+"' is already defined";return ig._current={name:t,requires:[],loaded:!1,body:null},ig.modules[t]=ig._current,ig._loadQueue.push(ig._current),ig},requires:function(){return ig._current.requires=Array.prototype.slice.call(arguments),ig},defines:function(t){ig._current.body=t,ig._current=null,ig._initDOMReady()},addResource:function(t){ig.resources.push(t)},setNocache:function(t){ig.nocache=t?"?"+Date.now():""},log:function(){},assert:function(t,i){},show:function(t,i){},mark:function(t,i){},_loadScript:function(t,i){ig.modules[t]={name:t,requires:[],loaded:!1,body:null},ig._waitForOnload++;var e=ig.prefix+ig.lib+t.replace(/\./g,"/")+".js"+ig.nocache,s=ig.$new("script");s.type="text/javascript",s.src=e,s.onload=function(){ig._waitForOnload--,ig._execModules()},s.onerror=function(){throw"Failed to load module "+t+" at "+e+" required from "+i},ig.$("head")[0].appendChild(s)},_execModules:function(){for(var t=!1,i=0;i<ig._loadQueue.length;i++){for(var e=ig._loadQueue[i],s=!0,n=0;n<e.requires.length;n++){var a=e.requires[n];ig.modules[a]?ig.modules[a].loaded||(s=!1):(s=!1,ig._loadScript(a,e.name))}s&&e.body&&(ig._loadQueue.splice(i,1),e.loaded=!0,e.body(),t=!0,i--)}if(t)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){for(var o=[],i=0;i<ig._loadQueue.length;i++){for(var h=[],r=ig._loadQueue[i].requires,n=0;n<r.length;n++){var e=ig.modules[r[n]];e&&e.loaded||h.push(r[n])}o.push(ig._loadQueue[i].name+" (requires: "+h.join(", ")+")")}throw"Unresolved (or circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules or a previous syntax error prevents a module from loading:\n"+o.join("\n")}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0,ig._waitForOnload--,ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0),ig.ua.pixelRatio=t.devicePixelRatio||1,ig.ua.viewport={width:t.innerWidth,height:t.innerHeight},ig.ua.screen={width:t.screen.availWidth*ig.ua.pixelRatio,height:t.screen.availHeight*ig.ua.pixelRatio},ig.ua.iPhone=/iPhone|iPod/i.test(navigator.userAgent),ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio,ig.ua.iPad=/iPad/i.test(navigator.userAgent),ig.ua.android=/android/i.test(navigator.userAgent),ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent),ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad,ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||/mobile/i.test(navigator.userAgent),ig.ua.touchDevice="ontouchstart"in t||t.navigator.msMaxTouchPoints},_initDOMReady:function(){if(ig.modules["dom.ready"])return void ig._execModules();ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,"complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),t.addEventListener("load",ig._DOMReady,!1))}},ig.normalizeVendorAttribute(t,"requestAnimationFrame"),t.requestAnimationFrame){var i=1,e={};t.ig.setAnimation=function(s,n){var a=i++;e[a]=!0;var o=function(){e[a]&&(t.requestAnimationFrame(o,n),s())};return t.requestAnimationFrame(o,n),a},t.ig.clearAnimation=function(t){delete e[t]}}else t.ig.setAnimation=function(i,e){return t.setInterval(i,1e3/60)},t.ig.clearAnimation=function(i){t.clearInterval(i)};var s=!1,n=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/,a=0;t.ig.Class=function(){};var o=function(t){var i=this.prototype,e={};for(var s in t)"function"==typeof t[s]&&"function"==typeof i[s]&&n.test(t[s])?(e[s]=i[s],i[s]=function(t,i){return function(){var s=this.parent;this.parent=e[t];var n=i.apply(this,arguments);return this.parent=s,n}}(s,t[s])):i[s]=t[s]};t.ig.Class.extend=function(i){function e(){if(!s){if(this.staticInstantiate){var t=this.staticInstantiate.apply(this,arguments);if(t)return t}for(var i in this)"object"==typeof this[i]&&(this[i]=ig.copy(this[i]));this.init&&this.init.apply(this,arguments)}return this}var h=this.prototype;s=!0;var r=new this;s=!1;for(var l in i)"function"==typeof i[l]&&"function"==typeof h[l]&&n.test(i[l])?r[l]=function(t,i){return function(){var e=this.parent;this.parent=h[t];var s=i.apply(this,arguments);return this.parent=e,s}}(l,i[l]):r[l]=i[l];return e.prototype=r,e.prototype.constructor=e,e.extend=t.ig.Class.extend,e.inject=o,e.classId=r.classId=++a,e},t.ImpactMixin&&ig.merge(ig,t.ImpactMixin)}(window),ig.baked=!0,ig.module("impact.image").defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(t){return ig.Image.cache[t]||null},init:function(t){this.path=t,this.load()},load:function(t){if(this.loaded)return void(t&&t(this.path,!0));!this.loaded&&ig.ready?(this.loadCallback=t||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),ig.Image.cache[this.path]=this},reload:function(){this.loaded=!1,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.src=this.path+"?"+Date.now()},onload:function(t){this.width=this.data.width,this.height=this.data.height,this.loaded=!0,1!=ig.system.scale&&this.resize(ig.system.scale),this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(t){this.failed=!0,this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(t){var i=ig.getImagePixels(this.data,0,0,this.width,this.height),e=this.width*t,s=this.height*t,n=ig.$new("canvas");n.width=e,n.height=s;for(var a=n.getContext("2d"),o=a.getImageData(0,0,e,s),h=0;h<s;h++)for(var r=0;r<e;r++){var l=4*(Math.floor(h/t)*this.width+Math.floor(r/t)),u=4*(h*e+r);o.data[u]=i.data[l],o.data[u+1]=i.data[l+1],o.data[u+2]=i.data[l+2],o.data[u+3]=i.data[l+3]}a.putImageData(o,0,0),this.data=n},draw:function(t,i,e,s,n,a){if(this.loaded){var o=ig.system.scale;e=e?e*o:0,s=s?s*o:0,n=(n||this.width)*o,a=(a||this.height)*o,ig.system.context.drawImage(this.data,e,s,n,a,ig.system.getDrawPos(t),ig.system.getDrawPos(i),n,a),ig.Image.drawCount++}},drawTile:function(t,i,e,s,n,a,o){if(n=n||s,!(!this.loaded||s>this.width||n>this.height)){var h=ig.system.scale,r=Math.floor(s*h),l=Math.floor(n*h),u=a?-1:1,c=o?-1:1;(a||o)&&(ig.system.context.save(),ig.system.context.scale(u,c)),ig.system.context.drawImage(this.data,Math.floor(e*s)%this.width*h,Math.floor(e*s/this.width)*n*h,r,l,ig.system.getDrawPos(t)*u-(a?r:0),ig.system.getDrawPos(i)*c-(o?l:0),r,l),(a||o)&&ig.system.context.restore(),ig.Image.drawCount++}}}),ig.Image.drawCount=0,ig.Image.cache={},ig.Image.reloadCache=function(){for(var t in ig.Image.cache)ig.Image.cache[t].reload()}}),ig.baked=!0,ig.module("impact.font").requires("impact.image").defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(t){this._loadMetrics(this.data),this.parent(t),this.height-=2},widthForString:function(t){if(-1!==t.indexOf("\n")){for(var i=t.split("\n"),e=0,s=0;s<i.length;s++)e=Math.max(e,this._widthForLine(i[s]));return e}return this._widthForLine(t)},_widthForLine:function(t){for(var i=0,e=0;e<t.length;e++)i+=this.widthMap[t.charCodeAt(e)-this.firstChar];return t.length>0&&(i+=this.letterSpacing*(t.length-1)),i},heightForString:function(t){return t.split("\n").length*(this.height+this.lineSpacing)},draw:function(t,i,e,s){if("string"!=typeof t&&(t=t.toString()),-1===t.indexOf("\n")){if(s==ig.Font.ALIGN.RIGHT||s==ig.Font.ALIGN.CENTER){var n=this._widthForLine(t);i-=s==ig.Font.ALIGN.CENTER?n/2:n}1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(var a=0;a<t.length;a++){var o=t.charCodeAt(a);i+=this._drawChar(o-this.firstChar,i,e)}1!==this.alpha&&(ig.system.context.globalAlpha=1),ig.Image.drawCount+=t.length}else for(var h=t.split("\n"),r=this.height+this.lineSpacing,a=0;a<h.length;a++)this.draw(h[a],i,e+a*r,s)},_drawChar:function(t,i,e){if(!this.loaded||t<0||t>=this.indices.length)return 0;var s=ig.system.scale,n=this.indices[t]*s,a=this.widthMap[t]*s,o=(this.height-2)*s;return ig.system.context.drawImage(this.data,n,0,a,o,ig.system.getDrawPos(i),ig.system.getDrawPos(e),a,o),this.widthMap[t]+this.letterSpacing},_loadMetrics:function(t){this.widthMap=[],this.indices=[];for(var i=ig.getImagePixels(t,0,t.height-1,t.width,1),e=0,s=0,n=0;n<t.width;n++){var a=4*n+3;i.data[a]>127?s++:i.data[a]<128&&s&&(this.widthMap.push(s),this.indices.push(n-s),e++,s=0)}this.widthMap.push(s),this.indices.push(n-s)}}),ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}}),ig.baked=!0,ig.module("impact.sound").defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio)return void(ig.Sound.enabled=!1);for(var t=new Audio,i=0;i<ig.Sound.use.length;i++){var e=ig.Sound.use[i];if(t.canPlayType(e.mime)){this.format=e;break}}this.format||(ig.Sound.enabled=!1),ig.Sound.enabled&&ig.Sound.useWebAudio&&(this.audioContext=new AudioContext,this.boundWebAudioUnlock=this.unlockWebAudio.bind(this),document.addEventListener("touchstart",this.boundWebAudioUnlock,!1))},unlockWebAudio:function(){document.removeEventListener("touchstart",this.boundWebAudioUnlock,!1);var t=this.audioContext.createBuffer(1,1,22050),i=this.audioContext.createBufferSource();i.buffer=t,i.connect(this.audioContext.destination),i.start(0)},load:function(t,i,e){return i&&ig.Sound.useWebAudio?this.loadWebAudio(t,i,e):this.loadHTML5Audio(t,i,e)},loadWebAudio:function(t,i,e){var s=ig.prefix+t.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[t])return this.clips[t];var n=new ig.Sound.WebAudioSource;this.clips[t]=n;var a=new XMLHttpRequest;a.open("GET",s,!0),a.responseType="arraybuffer";var o=this;return a.onload=function(i){o.audioContext.decodeAudioData(a.response,function(s){n.buffer=s,e&&e(t,!0,i)},function(i){e&&e(t,!1,i)})},a.onerror=function(i){e&&e(t,!1,i)},a.send(),n},loadHTML5Audio:function(t,i,e){var s=ig.prefix+t.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[t]){if(this.clips[t]instanceof ig.Sound.WebAudioSource)return this.clips[t];if(i&&this.clips[t].length<ig.Sound.channels)for(var n=this.clips[t].length;n<ig.Sound.channels;n++){var a=new Audio(s);a.load(),this.clips[t].push(a)}return this.clips[t][0]}var o=new Audio(s);if(e&&(ig.ua.mobile?setTimeout(function(){e(t,!0,null)},0):(o.addEventListener("canplaythrough",function i(s){o.removeEventListener("canplaythrough",i,!1),e(t,!0,s)},!1),o.addEventListener("error",function(i){e(t,!1,i)},!1))),o.preload="auto",o.load(),this.clips[t]=[o],i)for(var n=1;n<ig.Sound.channels;n++){var a=new Audio(s);a.load(),this.clips[t].push(a)}return o},get:function(t){var i=this.clips[t];if(i&&i instanceof ig.Sound.WebAudioSource)return i;for(var e,s=0;e=i[s++];)if(e.paused||e.ended)return e.ended&&(e.currentTime=0),e;return i[0].pause(),i[0].currentTime=0,i[0]}}),ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this),Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})},add:function(t,i){if(ig.Sound.enabled){var e=t instanceof ig.Sound?t.path:t,s=ig.soundManager.load(e,!1);if(s instanceof ig.Sound.WebAudioSource)throw ig.system.stopRunLoop(),"Sound '"+e+"' loaded as Multichannel but used for Music. Set the multiChannel param to false when loading, e.g.: new ig.Sound(path, false)";s.loop=this._loop,s.volume=this._volume,s.addEventListener("ended",this._endedCallbackBound,!1),this.tracks.push(s),i&&(this.namedTracks[i]=s),this.currentTrack||(this.currentTrack=s)}},next:function(){this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play())},pause:function(){this.currentTrack&&this.currentTrack.pause()},stop:function(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0)},play:function(t){if(t&&this.namedTracks[t]){var i=this.namedTracks[t];i!=this.currentTrack&&(this.stop(),this.currentTrack=i)}else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t;for(var i in this.tracks)this.tracks[i].loop=t},getVolume:function(){return this._volume},setVolume:function(t){this._volume=t.limit(0,1);for(var i in this.tracks)this.tracks[i].volume=this._volume},fadeOut:function(t){this.currentTrack&&(clearInterval(this._fadeInterval),this._fadeTimer=new ig.Timer(t),this._fadeInterval=setInterval(this._fadeStep.bind(this),50))},_fadeStep:function(){var t=this._fadeTimer.delta().map(-this._fadeTimer.target,0,1,0).limit(0,1)*this._volume;t<=.01?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=t},_endedCallback:function(){this._loop?this.play():this.next()}}),ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,_loop:!1,init:function(t,i){this.path=t,this.multiChannel=!1!==i,Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)}),this.load()},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t,this.currentClip&&(this.currentClip.loop=t)},load:function(t){if(!ig.Sound.enabled)return void(t&&t(this.path,!0));ig.ready?ig.soundManager.load(this.path,this.multiChannel,t):ig.addResource(this)},play:function(){ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.loop=this._loop,this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play())},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}}),ig.Sound.WebAudioSource=ig.Class.extend({sources:[],gain:null,buffer:null,_loop:!1,init:function(){this.gain=ig.soundManager.audioContext.createGain(),this.gain.connect(ig.soundManager.audioContext.destination),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)}),Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)})},play:function(){if(this.buffer){var t=ig.soundManager.audioContext.createBufferSource();t.buffer=this.buffer,t.connect(this.gain),t.loop=this._loop;var i=this;this.sources.push(t),t.onended=function(){i.sources.erase(t)},t.start(0)}},pause:function(){for(var t=0;t<this.sources.length;t++)try{this.sources[t].stop()}catch(t){}},getLooping:function(){return this._loop},setLooping:function(t){this._loop=t;for(var i=0;i<this.sources.length;i++)this.sources[i].loop=t},getVolume:function(){return this.gain.gain.value},setVolume:function(t){this.gain.gain.value=t}}),ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}},ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3],ig.Sound.channels=4,ig.Sound.enabled=!0,ig.normalizeVendorAttribute(window,"AudioContext"),ig.Sound.useWebAudio=!!window.AudioContext}),ig.baked=!0,ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(t,i){this.gameClass=t,this.resources=i,this._loadCallbackBound=this._loadCallback.bind(this);for(var e=0;e<this.resources.length;e++)this._unloaded.push(this.resources[e].path)},load:function(){if(ig.system.clear("#000"),!this.resources.length)return void this.end();for(var t=0;t<this.resources.length;t++)this.loadResource(this.resources[t]);this._intervalId=setInterval(this.draw.bind(this),16)},loadResource:function(t){t.load(this._loadCallbackBound)},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass))},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var t=ig.system.scale,i=.6*ig.system.width,e=.1*ig.system.height,s=.5*ig.system.width-i/2,n=.5*ig.system.height-e/2;ig.system.context.fillStyle="#000",ig.system.context.fillRect(0,0,480,320),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(s*t,n*t,i*t,e*t),ig.system.context.fillStyle="#000",ig.system.context.fillRect(s*t+t,n*t+t,i*t-t-t,e*t-t-t),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(s*t,n*t,i*t*this._drawStatus,e*t)},_loadCallback:function(t,i){if(!i)throw"Failed to load resource: "+t;this._unloaded.erase(t),this.status=1-this._unloaded.length/this.resources.length,0==this._unloaded.length&&setTimeout(this.end.bind(this),250)}})}),ig.baked=!0,ig.module("impact.timer").defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(t){this.base=ig.Timer.time,this.last=ig.Timer.time,this.target=t||0},set:function(t){this.target=t||0,this.base=ig.Timer.time,this.pausedAt=0},reset:function(){this.base=ig.Timer.time,this.pausedAt=0},tick:function(){var t=ig.Timer.time-this.last;return this.last=ig.Timer.time,this.pausedAt?0:t},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}}),ig.Timer._last=0,ig.Timer.time=Number.MIN_VALUE,ig.Timer.timeScale=1,ig.Timer.maxStep=.05,ig.Timer.step=function(){var t=Date.now(),i=(t-ig.Timer._last)/1e3;ig.Timer.time+=Math.min(i,ig.Timer.maxStep)*ig.Timer.timeScale,ig.Timer._last=t}}),ig.baked=!0,ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(t,i,e,s,n){this.fps=i,this.clock=new ig.Timer,this.canvas=ig.$(t),this.resize(e,s,n),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode,1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP),ig.System.scaleMode(this.canvas,this.context)},resize:function(t,i,e){this.width=t,this.height=i,this.scale=e||this.scale,this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight},setGame:function(t){this.running?this.newGameClass=t:this.setGameNow(t)},setGameNow:function(t){ig.game=new t,ig.system.setDelegate(ig.game)},setDelegate:function(t){if("function"!=typeof t.run)throw"System.setDelegate: No run() function in object";this.delegate=t,this.startRunLoop()},stopRunLoop:function(){ig.clearAnimation(this.animationId),this.running=!1},startRunLoop:function(){this.stopRunLoop(),this.animationId=ig.setAnimation(this.run.bind(this),this.canvas),this.running=!0},clear:function(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step(),this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null}),ig.System.DRAW={AUTHENTIC:function(t){return Math.round(t)*this.scale},SMOOTH:function(t){return Math.round(t*this.scale)},SUBPIXEL:function(t){return t*this.scale}},ig.System.drawMode=ig.System.DRAW.SMOOTH,ig.System.SCALE={CRISP:function(t,i){ig.setVendorAttribute(i,"imageSmoothingEnabled",!1),t.style.imageRendering="-moz-crisp-edges",t.style.imageRendering="-o-crisp-edges",t.style.imageRendering="-webkit-optimize-contrast",t.style.imageRendering="crisp-edges",t.style.msInterpolationMode="nearest-neighbor"},SMOOTH:function(t,i){ig.setVendorAttribute(i,"imageSmoothingEnabled",!0),t.style.imageRendering="",t.style.msInterpolationMode=""}},ig.System.scaleMode=ig.System.SCALE.SMOOTH}),ig.baked=!0,ig.module("impact.input").defines(function(){"use strict";ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=!0;var t=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",t,!1),ig.system.canvas.addEventListener("DOMMouseScroll",t,!1),ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchcancel",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none")}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||(this.isUsingAccelerometer=!0,window.addEventListener("devicemotion",this.devicemotion.bind(this),!1))},mousewheel:function(t){var i=t.wheelDelta?t.wheelDelta:-1*t.detail,e=i>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN,s=this.bindings[e];s&&(this.actions[s]=!0,this.presses[s]=!0,this.delayedKeyup[s]=!0,t.stopPropagation(),t.preventDefault())},mousemove:function(t){var i=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,e=ig.system.scale*(i/ig.system.realWidth),s={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(s=ig.system.canvas.getBoundingClientRect());var n=t.touches?t.touches[0]:t;this.mouse.x=(n.clientX-s.left)/e,this.mouse.y=(n.clientY-s.top)/e},contextmenu:function(t){this.bindings[ig.KEY.MOUSE2]&&(t.stopPropagation(),t.preventDefault())},keydown:function(t){var i=t.target.tagName;if("INPUT"!=i&&"TEXTAREA"!=i){var e="keydown"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1;e<0&&!ig.ua.mobile&&window.focus(),"touchstart"!=t.type&&"mousedown"!=t.type||this.mousemove(t);var s=this.bindings[e];s&&(this.actions[s]=!0,this.locks[s]||(this.presses[s]=!0,this.locks[s]=!0),t.preventDefault())}},keyup:function(t){var i=t.target.tagName;if("INPUT"!=i&&"TEXTAREA"!=i){var e="keyup"==t.type?t.keyCode:2==t.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,s=this.bindings[e];s&&(this.delayedKeyup[s]=!0,t.preventDefault())}},devicemotion:function(t){this.accel=t.accelerationIncludingGravity},bind:function(t,i){t<0?this.initMouse():t>0&&this.initKeyboard(),this.bindings[t]=i},bindTouch:function(t,i){var e=ig.$(t),s=this;e.addEventListener("touchstart",function(t){s.touchStart(t,i)},!1),e.addEventListener("touchend",function(t){s.touchEnd(t,i)},!1),e.addEventListener("MSPointerDown",function(t){s.touchStart(t,i)},!1),e.addEventListener("MSPointerUp",function(t){s.touchEnd(t,i)},!1)},unbind:function(t){var i=this.bindings[t];this.delayedKeyup[i]=!0,this.bindings[t]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup={}},state:function(t){return this.actions[t]},pressed:function(t){return this.presses[t]},released:function(t){return!!this.delayedKeyup[t]},clearPressed:function(){for(var t in this.delayedKeyup)this.actions[t]=!1,this.locks[t]=!1;this.delayedKeyup={},this.presses={}},touchStart:function(t,i){return this.actions[i]=!0,this.presses[i]=!0,t.stopPropagation(),t.preventDefault(),!1},touchEnd:function(t,i){return this.delayedKeyup[i]=!0,t.stopPropagation(),t.preventDefault(),!1}})}),ig.baked=!0,ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){"use strict";ig.main=function(t,i,e,s,n,a,o){ig.system=new ig.System(t,e,s,n,a||1),ig.input=new ig.Input,ig.soundManager=new ig.SoundManager,ig.music=new ig.Music,ig.ready=!0,new(o||ig.Loader)(i,ig.resources).load()}}),ig.baked=!0,ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(t,i,e){this.width=i,this.height=e,this.image=new ig.Image(t)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(t,i,e,s){this.sheet=t,this.pivot={x:t.width/2,y:t.height/2},this.timer=new ig.Timer,this.frameTime=i,this.sequence=e,this.stop=!!s,this.tile=this.sequence[0]},rewind:function(){return this.timer.set(),this.loopCount=0,this.frame=0,this.tile=this.sequence[0],this},gotoFrame:function(t){this.timer.set(this.frameTime*-t-1e-4),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var t=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(t/this.sequence.length),this.stop&&this.loopCount>0?this.frame=this.sequence.length-1:this.frame=t%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(t,i){var e=Math.max(this.sheet.width,this.sheet.height);t>ig.system.width||i>ig.system.height||t+e<0||i+e<0||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(t,i,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(t+this.pivot.x),ig.system.getDrawPos(i+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})}),ig.baked=!0,ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(t,i,e){this.id=++ig.Entity._lastId,this.pos.x=this.last.x=t,this.pos.y=this.last.y=i,ig.merge(this,e)},reset:function(t,i,e){var s=this.constructor.prototype;this.pos.x=t,this.pos.y=i,this.last.x=t,this.last.y=i,this.vel.x=s.vel.x,this.vel.y=s.vel.y,this.accel.x=s.accel.x,this.accel.y=s.accel.y,this.health=s.health,this._killed=s._killed,this.standing=s.standing,this.type=s.type,this.checkAgainst=s.checkAgainst,this.collides=s.collides,ig.merge(this,e)},addAnim:function(t,i,e,s){if(!this.animSheet)throw"No animSheet to add the animation "+t+" to.";var n=new ig.Animation(this.animSheet,i,e,s);return this.anims[t]=n,this.currentAnim||(this.currentAnim=n),n},update:function(){this.last.x=this.pos.x,this.last.y=this.pos.y,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor,this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var t=this.vel.x*ig.system.tick,i=this.vel.y*ig.system.tick,e=ig.game.collisionMap.trace(this.pos.x,this.pos.y,t,i,this.size.x,this.size.y);this.handleMovementTrace(e),this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(t,i,e,s){if(i)return(t+i*ig.system.tick).limit(-s,s);if(e){
var n=e*ig.system.tick;return t-n>0?t-n:t+n<0?t+n:0}return t.limit(-s,s)},handleMovementTrace:function(t){if(this.standing=!1,t.collision.y&&(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(this.vel.y>0&&(this.standing=!0),this.vel.y=0)),t.collision.x&&(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0),t.collision.slope){var i=t.collision.slope;if(this.bounciness>0){var e=this.vel.x*i.nx+this.vel.y*i.ny;this.vel.x=(this.vel.x-i.nx*e*2)*this.bounciness,this.vel.y=(this.vel.y-i.ny*e*2)*this.bounciness}else{var s=i.x*i.x+i.y*i.y,n=(this.vel.x*i.x+this.vel.y*i.y)/s;this.vel.x=i.x*n,this.vel.y=i.y*n;var a=Math.atan2(i.x,i.y);a>this.slopeStanding.min&&a<this.slopeStanding.max&&(this.standing=!0)}}this.pos=t.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(t,i){this.health-=t,this.health<=0&&this.kill()},touches:function(t){return!(this.pos.x>=t.pos.x+t.size.x||this.pos.x+this.size.x<=t.pos.x||this.pos.y>=t.pos.y+t.size.y||this.pos.y+this.size.y<=t.pos.y)},distanceTo:function(t){var i=this.pos.x+this.size.x/2-(t.pos.x+t.size.x/2),e=this.pos.y+this.size.y/2-(t.pos.y+t.size.y/2);return Math.sqrt(i*i+e*e)},angleTo:function(t){return Math.atan2(t.pos.y+t.size.y/2-(this.pos.y+this.size.y/2),t.pos.x+t.size.x/2-(this.pos.x+this.size.x/2))},check:function(t){},collideWith:function(t,i){},ready:function(){},erase:function(){}}),ig.Entity._lastId=0,ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8},ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3},ig.Entity.checkPair=function(t,i){t.checkAgainst&i.type&&t.check(i),i.checkAgainst&t.type&&i.check(t),t.collides&&i.collides&&t.collides+i.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(t,i)},ig.Entity.solveCollision=function(t,i){var e=null;t.collides==ig.Entity.COLLIDES.LITE||i.collides==ig.Entity.COLLIDES.FIXED?e=t:i.collides!=ig.Entity.COLLIDES.LITE&&t.collides!=ig.Entity.COLLIDES.FIXED||(e=i),t.last.x+t.size.x>i.last.x&&t.last.x<i.last.x+i.size.x?(t.last.y<i.last.y?ig.Entity.seperateOnYAxis(t,i,e):ig.Entity.seperateOnYAxis(i,t,e),t.collideWith(i,"y"),i.collideWith(t,"y")):t.last.y+t.size.y>i.last.y&&t.last.y<i.last.y+i.size.y&&(t.last.x<i.last.x?ig.Entity.seperateOnXAxis(t,i,e):ig.Entity.seperateOnXAxis(i,t,e),t.collideWith(i,"x"),i.collideWith(t,"x"))},ig.Entity.seperateOnXAxis=function(t,i,e){var s=t.pos.x+t.size.x-i.pos.x;if(e){var n=t===e?i:t;e.vel.x=-e.vel.x*e.bounciness+n.vel.x;var a=ig.game.collisionMap.trace(e.pos.x,e.pos.y,e==t?-s:s,0,e.size.x,e.size.y);e.pos.x=a.pos.x}else{var o=(t.vel.x-i.vel.x)/2;t.vel.x=-o,i.vel.x=o;var h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,-s/2,0,t.size.x,t.size.y);t.pos.x=Math.floor(h.pos.x);var r=ig.game.collisionMap.trace(i.pos.x,i.pos.y,s/2,0,i.size.x,i.size.y);i.pos.x=Math.ceil(r.pos.x)}},ig.Entity.seperateOnYAxis=function(t,i,e){var s=t.pos.y+t.size.y-i.pos.y;if(e){var n=t===e?i:t;e.vel.y=-e.vel.y*e.bounciness+n.vel.y;var a=0;e==t&&Math.abs(e.vel.y-n.vel.y)<e.minBounceVelocity&&(e.standing=!0,a=n.vel.x*ig.system.tick);var o=ig.game.collisionMap.trace(e.pos.x,e.pos.y,a,e==t?-s:s,e.size.x,e.size.y);e.pos.y=o.pos.y,e.pos.x=o.pos.x}else if(ig.game.gravity&&(i.standing||t.vel.y>0)){var h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,0,-(t.pos.y+t.size.y-i.pos.y),t.size.x,t.size.y);t.pos.y=h.pos.y,t.bounciness>0&&t.vel.y>t.minBounceVelocity?t.vel.y*=-t.bounciness:(t.standing=!0,t.vel.y=0)}else{var r=(t.vel.y-i.vel.y)/2;t.vel.y=-r,i.vel.y=r;var a=i.vel.x*ig.system.tick,h=ig.game.collisionMap.trace(t.pos.x,t.pos.y,a,-s/2,t.size.x,t.size.y);t.pos.y=h.pos.y;var l=ig.game.collisionMap.trace(i.pos.x,i.pos.y,0,s/2,i.size.x,i.size.y);i.pos.y=l.pos.y}}}),ig.baked=!0,ig.module("impact.map").defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(t,i){this.tilesize=t,this.data=i,this.height=i.length,this.width=i[0].length,this.pxWidth=this.width*this.tilesize,this.pxHeight=this.height*this.tilesize},getTile:function(t,i){var e=Math.floor(t/this.tilesize),s=Math.floor(i/this.tilesize);return e>=0&&e<this.width&&s>=0&&s<this.height?this.data[s][e]:0},setTile:function(t,i,e){var s=Math.floor(t/this.tilesize),n=Math.floor(i/this.tilesize);s>=0&&s<this.width&&n>=0&&n<this.height&&(this.data[n][s]=e)}})}),ig.baked=!0,ig.module("impact.collision-map").requires("impact.map").defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(t,i,e){this.parent(t,i),this.tiledef=e||ig.CollisionMap.defaultTileDef;for(var s in this.tiledef)s|0>this.lastSlope&&(this.lastSlope=0|s)},trace:function(t,i,e,s,n,a){var o={collision:{x:!1,y:!1,slope:!1},pos:{x:t,y:i},tile:{x:0,y:0}},h=Math.ceil((Math.max(Math.abs(e),Math.abs(s))+.1)/this.tilesize);if(h>1)for(var r=e/h,l=s/h,u=0;u<h&&(r||l)&&(this._traceStep(o,t,i,r,l,n,a,e,s,u),t=o.pos.x,i=o.pos.y,o.collision.x&&(r=0,e=0),o.collision.y&&(l=0,s=0),!o.collision.slope);u++);else this._traceStep(o,t,i,e,s,n,a,e,s,0);return o},_traceStep:function(t,i,e,s,n,a,o,h,r,l){t.pos.x+=s,t.pos.y+=n;var u=0;if(s){var c=s>0?a:0,d=s<0?this.tilesize:0,g=Math.max(Math.floor(e/this.tilesize),0),p=Math.min(Math.ceil((e+o)/this.tilesize),this.height),m=Math.floor((t.pos.x+c)/this.tilesize),f=Math.floor((i+c)/this.tilesize);if((l>0||m==f||f<0||f>=this.width)&&(f=-1),m>=0&&m<this.width)for(var y=g;y<p&&!(-1!=f&&(u=this.data[y][f])>1&&u<=this.lastSlope&&this._checkTileDef(t,u,i,e,h,r,a,o,f,y));y++)if(1==(u=this.data[y][m])||u>this.lastSlope||u>1&&this._checkTileDef(t,u,i,e,h,r,a,o,m,y)){if(u>1&&u<=this.lastSlope&&t.collision.slope)break;t.collision.x=!0,t.tile.x=u,i=t.pos.x=m*this.tilesize-c+d,h=0;break}}if(n){var v=n>0?o:0,x=n<0?this.tilesize:0,w=Math.max(Math.floor(t.pos.x/this.tilesize),0),b=Math.min(Math.ceil((t.pos.x+a)/this.tilesize),this.width),y=Math.floor((t.pos.y+v)/this.tilesize),E=Math.floor((e+v)/this.tilesize);if((l>0||y==E||E<0||E>=this.height)&&(E=-1),y>=0&&y<this.height)for(var m=w;m<b&&!(-1!=E&&(u=this.data[E][m])>1&&u<=this.lastSlope&&this._checkTileDef(t,u,i,e,h,r,a,o,m,E));m++)if(1==(u=this.data[y][m])||u>this.lastSlope||u>1&&this._checkTileDef(t,u,i,e,h,r,a,o,m,y)){if(u>1&&u<=this.lastSlope&&t.collision.slope)break;t.collision.y=!0,t.tile.y=u,t.pos.y=y*this.tilesize-v+x;break}}},_checkTileDef:function(t,i,e,s,n,a,o,h,r,l){var u=this.tiledef[i];if(!u)return!1;var c=(r+u[0])*this.tilesize,d=(l+u[1])*this.tilesize,g=(u[2]-u[0])*this.tilesize,p=(u[3]-u[1])*this.tilesize,m=u[4],f=e+n+(p<0?o:0)-c,y=s+a+(g>0?h:0)-d;if(g*y-p*f>0){if(n*-p+a*g<0)return m;var v=Math.sqrt(g*g+p*p),x=p/v,w=-g/v,b=f*x+y*w,E=x*b,T=w*b;return E*E+T*T>=n*n+a*a?m||g*(y-a)-p*(f-n)<.5:(t.pos.x=e+n-E,t.pos.y=s+a-T,t.collision.slope={x:g,y:p,nx:x,ny:w},!0)}return!1}});var t=.5,i=1/3,e=2/3;ig.CollisionMap.defaultTileDef={5:[0,1,1,e,!0],6:[0,e,1,i,!0],7:[0,i,1,0,!0],3:[0,1,1,t,!0],4:[0,t,1,0,!0],2:[0,1,1,0,!0],10:[t,1,1,0,!0],21:[0,1,t,0,!0],32:[e,1,1,0,!0],43:[i,1,e,0,!0],54:[0,1,i,0,!0],27:[0,0,1,i,!0],28:[0,i,1,e,!0],29:[0,e,1,1,!0],25:[0,0,1,t,!0],26:[0,t,1,1,!0],24:[0,0,1,1,!0],11:[0,0,t,1,!0],22:[t,0,1,1,!0],33:[0,0,i,1,!0],44:[i,0,e,1,!0],55:[e,0,1,1,!0],16:[1,i,0,0,!0],17:[1,e,0,i,!0],18:[1,1,0,e,!0],14:[1,t,0,0,!0],15:[1,1,0,t,!0],13:[1,1,0,0,!0],8:[t,1,0,0,!0],19:[1,1,t,0,!0],30:[i,1,0,0,!0],41:[e,1,i,0,!0],52:[1,1,e,0,!0],38:[1,e,0,1,!0],39:[1,i,0,e,!0],40:[1,0,0,i,!0],36:[1,t,0,1,!0],37:[1,0,0,t,!0],35:[1,0,0,1,!0],9:[1,0,t,1,!0],20:[t,0,0,1,!0],31:[1,0,e,1,!0],42:[e,0,i,1,!0],53:[i,0,0,1,!0],12:[0,0,1,0,!1],23:[1,1,0,1,!1],34:[1,0,1,1,!1],45:[0,1,0,0,!1]},ig.CollisionMap.staticNoCollision={trace:function(t,i,e,s){return{collision:{x:!1,y:!1,slope:!1},pos:{x:t+e,y:i+s},tile:{x:0,y:0}}}}}),ig.baked=!0,ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(t,i,e){this.parent(t,i),this.setTileset(e)},setTileset:function(t){this.tilesetName=t instanceof ig.Image?t.path:t,this.tiles=new ig.Image(this.tilesetName),this.preRenderedChunks=null},setScreenPos:function(t,i){this.scroll.x=t/this.distance,this.scroll.y=i/this.distance},preRenderMapToChunks:function(){var t=this.width*this.tilesize*ig.system.scale,i=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(t,i),this.chunkSize);var e=Math.ceil(t/this.chunkSize),s=Math.ceil(i/this.chunkSize);this.preRenderedChunks=[];for(var n=0;n<s;n++){this.preRenderedChunks[n]=[];for(var a=0;a<e;a++){var o=a==e-1?t-a*this.chunkSize:this.chunkSize,h=n==s-1?i-n*this.chunkSize:this.chunkSize;this.preRenderedChunks[n][a]=this.preRenderChunk(a,n,o,h)}}},preRenderChunk:function(t,i,e,s){var n=e/this.tilesize/ig.system.scale+1,a=s/this.tilesize/ig.system.scale+1,o=t*this.chunkSize/ig.system.scale%this.tilesize,h=i*this.chunkSize/ig.system.scale%this.tilesize,r=Math.floor(t*this.chunkSize/this.tilesize/ig.system.scale),l=Math.floor(i*this.chunkSize/this.tilesize/ig.system.scale),u=ig.$new("canvas");u.width=e,u.height=s,u.retinaResolutionEnabled=!1;var c=u.getContext("2d");ig.System.scaleMode(u,c);var d=ig.system.context;ig.system.context=c;for(var g=0;g<n;g++)for(var p=0;p<a;p++)if(g+r<this.width&&p+l<this.height){var m=this.data[p+l][g+r];m&&this.tiles.drawTile(g*this.tilesize-o,p*this.tilesize-h,m-1,this.tilesize)}ig.system.context=d;var f=new Image;return f.src=u.toDataURL(),f},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled())},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var t=ig.system.getDrawPos(this.scroll.x),i=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var e=this.width*this.tilesize*ig.system.scale;t=(t%e+e)%e;var s=this.height*this.tilesize*ig.system.scale;i=(i%s+s)%s}var n=Math.max(Math.floor(t/this.chunkSize),0),a=Math.max(Math.floor(i/this.chunkSize),0),o=Math.ceil((t+ig.system.realWidth)/this.chunkSize),h=Math.ceil((i+ig.system.realHeight)/this.chunkSize),r=this.preRenderedChunks[0].length,l=this.preRenderedChunks.length;this.repeat||(o=Math.min(o,r),h=Math.min(h,l));for(var u=0,c=a;c<h;c++){for(var d=0,g=n;g<o;g++){var p=this.preRenderedChunks[c%l][g%r],m=-t+g*this.chunkSize-d,f=-i+c*this.chunkSize-u;ig.system.context.drawImage(p,m,f),ig.Image.drawCount++,this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(m,f,this.chunkSize,this.chunkSize)),this.repeat&&p.width<this.chunkSize&&m+p.width<ig.system.realWidth&&(d+=this.chunkSize-p.width,c==a&&o++)}this.repeat&&p.height<this.chunkSize&&f+p.height<ig.system.realHeight&&(u+=this.chunkSize-p.height,h++)}},drawTiled:function(){for(var t=0,i=null,e=(this.scroll.x/this.tilesize).toInt(),s=(this.scroll.y/this.tilesize).toInt(),n=this.scroll.x%this.tilesize,a=this.scroll.y%this.tilesize,o=-n-this.tilesize,h=-a-this.tilesize,r=ig.system.width+this.tilesize-n,l=ig.system.height+this.tilesize-a,u=-1,c=h;c<l;u++,c+=this.tilesize){var d=u+s;if(d>=this.height||d<0){if(!this.repeat)continue;d=(d%this.height+this.height)%this.height}for(var g=-1,p=o;p<r;g++,p+=this.tilesize){var m=g+e;if(m>=this.width||m<0){if(!this.repeat)continue;m=(m%this.width+this.width)%this.width}(t=this.data[d][m])&&((i=this.anims[t-1])?i.draw(p,c):this.tiles.drawTile(p,c,t-1,this.tilesize))}}}})}),ig.baked=!0,ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){return this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX,ig.game=this,null},loadLevel:function(t){this.screen={x:0,y:0},this.entities=[],this.namedEntities={};for(var i=0;i<t.entities.length;i++){var e=t.entities[i];this.spawnEntity(e.type,e.x,e.y,e.settings)}this.sortEntities(),this.collisionMap=ig.CollisionMap.staticNoCollision,this.backgroundMaps=[];for(var i=0;i<t.layer.length;i++){var s=t.layer[i];if("collision"==s.name)this.collisionMap=new ig.CollisionMap(s.tilesize,s.data);else{var n=new ig.BackgroundMap(s.tilesize,s.data,s.tilesetName);n.anims=this.backgroundAnims[s.tilesetName]||{},n.repeat=s.repeat,n.distance=s.distance,n.foreground=!!s.foreground,n.preRender=!!s.preRender,n.name=s.name,this.backgroundMaps.push(n)}}for(var i=0;i<this.entities.length;i++)this.entities[i].ready()},loadLevelDeferred:function(t){this._levelToLoad=t},getMapByName:function(t){if("collision"==t)return this.collisionMap;for(var i=0;i<this.backgroundMaps.length;i++)if(this.backgroundMaps[i].name==t)return this.backgroundMaps[i];return null},getEntityByName:function(t){return this.namedEntities[t]},getEntitiesByType:function(t){for(var i="string"==typeof t?ig.global[t]:t,e=[],s=0;s<this.entities.length;s++){var n=this.entities[s];n instanceof i&&!n._killed&&e.push(n)}return e},spawnEntity:function(t,i,e,s){var n="string"==typeof t?ig.global[t]:t;if(!n)throw"Can't spawn entity of type "+t;var a=new n(i,e,s||{});return this.entities.push(a),a.name&&(this.namedEntities[a.name]=a),a},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(t){t.name&&delete this.namedEntities[t.name],t._killed=!0,t.type=ig.Entity.TYPE.NONE,t.checkAgainst=ig.Entity.TYPE.NONE,t.collides=ig.Entity.COLLIDES.NEVER,this._deferredKill.push(t)},run:function(){this.update(),this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null),this.updateEntities(),this.checkEntities();for(var t=0;t<this._deferredKill.length;t++)this._deferredKill[t].erase(),this.entities.erase(this._deferredKill[t]);this._deferredKill=[],(this._doSortEntities||this.autoSort)&&(this.sortEntities(),this._doSortEntities=!1);for(var i in this.backgroundAnims){var e=this.backgroundAnims[i];for(var s in e)e[s].update()}},updateEntities:function(){for(var t=0;t<this.entities.length;t++){var i=this.entities[t];i._killed||i.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var t;for(t=0;t<this.backgroundMaps.length;t++){var i=this.backgroundMaps[t];if(i.foreground)break;i.setScreenPos(this.screen.x,this.screen.y),i.draw()}for(this.drawEntities(),t;t<this.backgroundMaps.length;t++){var i=this.backgroundMaps[t];i.setScreenPos(this.screen.x,this.screen.y),i.draw()}},drawEntities:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].draw()},checkEntities:function(){for(var t={},i=0;i<this.entities.length;i++){var e=this.entities[i];if(e.type!=ig.Entity.TYPE.NONE||e.checkAgainst!=ig.Entity.TYPE.NONE||e.collides!=ig.Entity.COLLIDES.NEVER)for(var s={},n=Math.floor(e.pos.x/this.cellSize),a=Math.floor(e.pos.y/this.cellSize),o=Math.floor((e.pos.x+e.size.x)/this.cellSize)+1,h=Math.floor((e.pos.y+e.size.y)/this.cellSize)+1,r=n;r<o;r++)for(var l=a;l<h;l++)if(t[r])if(t[r][l]){for(var u=t[r][l],c=0;c<u.length;c++)e.touches(u[c])&&!s[u[c].id]&&(s[u[c].id]=!0,ig.Entity.checkPair(e,u[c]));u.push(e)}else t[r][l]=[e];else t[r]={},t[r][l]=[e]}}}),ig.Game.SORT={Z_INDEX:function(t,i){return t.zIndex-i.zIndex},POS_X:function(t,i){return t.pos.x+t.size.x-(i.pos.x+i.size.x)},POS_Y:function(t,i){return t.pos.y+t.size.y-(i.pos.y+i.size.y)}}}),ig.baked=!0,ig.module("plugins.camera").defines(function(){"use strict";ig.Camera=ig.Class.extend({trap:{pos:{x:0,y:0},size:{x:16,y:16}},max:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},damping:5,lookAhead:{x:0,y:0},currentLookAhead:{x:0,y:0},debug:!1,init:function(t,i,e){this.offset.x=t,this.offset.y=i,this.damping=e},set:function(t){this.trap.pos.x=t.pos.x-this.trap.size.x/2,this.trap.pos.y=t.pos.y+t.size.y-this.trap.size.y,this.pos.x=this.trap.pos.x-this.offset.x,this.pos.y=this.trap.pos.y-this.offset.y,this.currentLookAhead.x=0,this.currentLookAhead.y=0},follow:function(t){this.pos.x=this.move("x",t.pos.x,t.size.x),this.pos.y=this.move("y",t.pos.y,t.size.y),ig.game.screen.x=this.pos.x,ig.game.screen.y=this.pos.y},move:function(t,i,e){return i<this.trap.pos[t]?(this.trap.pos[t]=i,this.currentLookAhead[t]=this.lookAhead[t]):i+e>this.trap.pos[t]+this.trap.size[t]&&(this.trap.pos[t]=i+e-this.trap.size[t],this.currentLookAhead[t]=-this.lookAhead[t]),(this.pos[t]-(this.pos[t]-this.trap.pos[t]+this.offset[t]+this.currentLookAhead[t])*ig.system.tick*this.damping).limit(0,this.max[t])},draw:function(){this.debug&&(ig.system.context.fillStyle="rgba(255,0,255,0.3)",ig.system.context.fillRect((this.trap.pos.x-this.pos.x)*ig.system.scale,(this.trap.pos.y-this.pos.y)*ig.system.scale,this.trap.size.x*ig.system.scale,this.trap.size.y*ig.system.scale))}})}),ig.baked=!0,ig.module("plugins.touch-button").requires("impact.system","impact.input","impact.image").defines(function(){"use strict";ig.TouchButton=ig.Class.extend({action:"undefined",image:null,tile:0,pos:{x:0,y:0},size:{x:0,y:0},area:{x1:0,y1:0,x2:0,y2:0},pressed:!1,touchId:0,anchor:null,init:function(t,i,e,s,n,a){this.action=t,this.anchor=i,this.size={x:e,y:s},this.image=n||null,this.tile=a||0},align:function(t,i){"left"in this.anchor?this.pos.x=this.anchor.left:"right"in this.anchor&&(this.pos.x=t-this.anchor.right-this.size.x),"top"in this.anchor?this.pos.y=this.anchor.top:"bottom"in this.anchor&&(this.pos.y=i-this.anchor.bottom-this.size.y);var e=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,s=ig.system.scale*(e/ig.system.realWidth);this.area={x1:this.pos.x*s,y1:this.pos.y*s,x2:(this.pos.x+this.size.x)*s,y2:(this.pos.y+this.size.y)*s}},touchStart:function(t){if(!this.pressed){var i={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(i=ig.system.canvas.getBoundingClientRect());for(var e=0;e<t.touches.length;e++){var s=t.touches[e];if(this.checkStart(s.identifier,s.clientX-i.left,s.clientY-i.top))return}}},touchEnd:function(t){if(this.pressed)for(var i=0;i<t.changedTouches.length;i++)if(this.checkEnd(t.changedTouches[i].identifier))return},touchStartMS:function(t){if(!this.pressed){var i={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(i=ig.system.canvas.getBoundingClientRect()),this.checkStart(t.pointerId,t.clientX-i.left,t.clientY-i.top)}},touchEndMS:function(t){this.pressed&&this.checkEnd(t.pointerId)},checkStart:function(t,i,e){return i>this.area.x1&&i<this.area.x2&&e>this.area.y1&&e<this.area.y2&&(this.pressed=!0,this.touchId=t,ig.input.actions[this.action]=!0,ig.input.locks[this.action]||(ig.input.presses[this.action]=!0,ig.input.locks[this.action]=!0),!0)},checkEnd:function(t){return t===this.touchId&&(this.pressed=!1,this.touchId=0,ig.input.delayedKeyup[this.action]=!0,!0)},draw:function(){this.image&&this.image.drawTile(this.pos.x,this.pos.y,this.tile,this.size.x,this.size.y)}}),ig.TouchButtonCollection=ig.Class.extend({buttons:[],init:function(t){this.buttons=t,document.addEventListener("touchstart",this.touchStart.bind(this),!1),document.addEventListener("touchend",this.touchEnd.bind(this),!1),document.addEventListener("MSPointerDown",this.touchStartMS.bind(this),!1),document.addEventListener("MSPointerUp",this.touchEndMS.bind(this),!1),document.body.style.msTouchAction="none"},touchStart:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchStart(t)},touchEnd:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchEnd(t)},touchStartMS:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchStartMS(t)},touchEndMS:function(t){t.preventDefault();for(var i=0;i<this.buttons.length;i++)this.buttons[i].touchEndMS(t)},align:function(){for(var t=ig.system.width||window.innerWidth,i=ig.system.height||window.innerHeight,e=0;e<this.buttons.length;e++)this.buttons[e].align(t,i)},draw:function(){for(var t=0;t<this.buttons.length;t++)this.buttons[t].draw()}})}),ig.baked=!0,ig.module("plugins.impact-splash-loader").requires("impact.loader").defines(function(){ig.ImpactSplashLoader=ig.Loader.extend({endTime:0,fadeToWhiteTime:200,fadeToGameTime:800,logoWidth:350,logoHeight:175,title:new ig.Image("media/logo.png"),end:function(){this.parent(),this.endTime=Date.now(),ig.system.setDelegate(this)},run:function(){var t=Date.now()-this.endTime,i=1;if(t<this.fadeToWhiteTime)this.draw(),i=t.map(0,this.fadeToWhiteTime,0,1);else{if(!(t<this.fadeToGameTime))return void ig.system.setDelegate(ig.game);ig.game.run(),i=t.map(this.fadeToWhiteTime,this.fadeToGameTime,1,0)}ig.system.context.fillStyle="rgba(255,255,255,"+i+")",ig.system.context.fillRect(0,0,ig.system.realWidth,ig.system.realHeight)},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5,"undefined"!=typeof FBInstant&&FBInstant.setLoadingProgress(Math.round(100*this.status));var t=ig.system.context,i=ig.system.realWidth,e=ig.system.realHeight,s=i/this.logoWidth/3,n=(i-this.logoWidth*s)/2;t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,i,e),t.fillStyle="rgb(128,128,128)",t.textAlign="right",t.font="16px Arial",t.fillText("http://github.com/swashvirus",i-10,e-10),t.textAlign="left",t.save(),t.translate(n,e/2.5),t.scale(s,s),t.lineWidth="3",t.strokeStyle="rgb(255,255,255)",t.strokeRect(25,this.logoHeight+40,300,20),t.fillStyle="rgb(255,255,255)",t.fillRect(30,this.logoHeight+45,290*this._drawStatus,10);var a=ig.system.width/2;ig.system.height,this.title.draw(a-this.title.width/2-125,60),t.restore()}})}),ig.baked=!0,ig.module("plugins.gamepad").requires("impact.input","impact.game").defines(function(){ig.GAMEPAD_BUTTON_OFFSET=256,ig.GAMEPAD={FACE_1:ig.GAMEPAD_BUTTON_OFFSET+0,FACE_2:ig.GAMEPAD_BUTTON_OFFSET+1,FACE_3:ig.GAMEPAD_BUTTON_OFFSET+2,FACE_4:ig.GAMEPAD_BUTTON_OFFSET+3,LEFT_SHOULDER:ig.GAMEPAD_BUTTON_OFFSET+4,RIGHT_SHOULDER:ig.GAMEPAD_BUTTON_OFFSET+5,LEFT_SHOULDER_BOTTOM:ig.GAMEPAD_BUTTON_OFFSET+6,RIGHT_SHOULDER_BOTTOM:ig.GAMEPAD_BUTTON_OFFSET+7,SELECT:ig.GAMEPAD_BUTTON_OFFSET+8,START:ig.GAMEPAD_BUTTON_OFFSET+9,LEFT_ANALOGUE_STICK:ig.GAMEPAD_BUTTON_OFFSET+10,RIGHT_ANALOGUE_STICK:ig.GAMEPAD_BUTTON_OFFSET+11,PAD_TOP:ig.GAMEPAD_BUTTON_OFFSET+12,PAD_BOTTOM:ig.GAMEPAD_BUTTON_OFFSET+13,PAD_LEFT:ig.GAMEPAD_BUTTON_OFFSET+14,PAD_RIGHT:ig.GAMEPAD_BUTTON_OFFSET+15},ig.normalizeVendorAttribute(navigator,"getGamepads"),navigator.getGamepads&&(ig.Input.inject({gamepad:null,lastButtons:{},hasButtonObject:!!window.GamepadButton,getFirstGamepadSnapshot:function(){for(var t=navigator.getGamepads(),i=0;i<t.length;i++)if(t[i])return t[i];return null},pollGamepad:function(){if(this.gamepad=this.getFirstGamepadSnapshot(),this.gamepad)for(var t=0;t<this.gamepad.buttons.length;t++){var i=this.bindings[t+ig.GAMEPAD_BUTTON_OFFSET],e=!1;if(i){var s=this.gamepad.buttons[t];e=void 0!==s.pressed?s.pressed:s;var n=this.lastButtons[t];!n&&e?(this.actions[i]=!0,this.presses[i]=!0):n&&!e&&(this.delayedKeyup[i]=!0)}this.lastButtons[t]=e}}}),ig.Game.inject({run:function(){ig.input.pollGamepad(),this.parent()}}))}),ig.baked=!0,ig.module("plugins.webstorage").defines(function(){"use strict";ig.Webstorage={support:function(){},get:function(t){return t=localStorage.getItem(t),parseInt(t)?parseInt(t):0},set:function(t,i){return localStorage.setItem(t,i),i}}}),ig.baked=!0,ig.module("monsterGame").requires("impact.game","impact.entity","impact.collision-map","impact.background-map","impact.font","plugins.camera","plugins.touch-button","plugins.impact-splash-loader","plugins.gamepad","plugins.webstorage").defines(function(){if(blastOff=ig.ImpactSplashLoader.extend({}),FullsizeBackdrop=ig.Image.extend({resize:function(){},draw:function(){this.loaded}}),EntityCoin=ig.Entity.extend({size:{x:36,y:36},animSheet:new ig.AnimationSheet("media/coin.png",36,36),type:ig.Entity.TYPE.B,sound:new ig.Sound("media/coin.ogg"),init:function(t,i,e){this.addAnim("idle",.1,[0,0,0,0,0,0,0,1,2]),this.parent(t,i,e)},update:function(){this.parent(),this.pos.y-ig.game.screen.y<-32&&this.kill()},pickup:function(){ig.game.score+=500,this.sound.play(),this.kill()}}),EntityPlayer=ig.Entity.extend({coins:0,speed:100,health:3,maxHealth:3,checkAgainst:ig.Entity.TYPE.B,animSheet:new ig.AnimationSheet("media/player.png",4814/55,120),size:{x:40,y:88},offset:{x:17,y:10},jump:500,maxVel:{x:400,y:800},friction:{x:800,y:0},speed:300,bounciness:.5,sound:new ig.Sound("media/bounce.ogg"),init:function(t,i,e){this.addAnim("idle",1,[0,0,0,0,0,6]),this.addAnim("run",.07,[10,7,8,6,5,6,8,7,10,7]),this.addAnim("jump",1,[3]),this.addAnim("fall",.1,[4,3],!0),this.addAnim("pain",.3,[4],!0),this.parent(t,i,e)},update:function(){ig.input.state("left")?(this.flip=!0,this.accel.x=-this.speed):ig.input.state("right")?(this.flip=!1,this.accel.x=this.speed):this.standing&&ig.input.pressed("jump")?this.vel.y=-this.jump:this.accel.x=0,this.vel.y<0?this.currentAnim=this.anims.jump:this.vel.y>0?this.currentAnim!=this.anims.fall&&(this.currentAnim=this.anims.fall.rewind()):0!=this.vel.x?this.currentAnim=this.anims.run:this.currentAnim=this.anims.idle,this.currentAnim.flip.x=this.flip,this.parent()},handleMovementTrace:function(t){t.collision.y&&this.vel.y>32&&this.sound.play(),this.parent(t)},check:function(t){this.coins++,t.pickup()}}),monsterGame=ig.Game.extend({clearColor:"#d0f4f7",gravity:800,font:new ig.Font("media/fredoka-one.font.png"),player:null,map:[],score:0,speed:100,highscore:this.highscore=ig.Webstorage.get("highscore"),tiles:new ig.Image("media/mushroom/tiles.png"),backdrop:new FullsizeBackdrop("media/mushroom/bg/bg_shroom.png"),heartFull:new ig.Image("media/heart-full.png"),heartEmpty:new ig.Image("media/heart-empty.png"),coinIcon:new ig.Image("media/coin.png"),gameOverSound:new ig.Sound("media/gameover.ogg"),music:new ig.Sound("media/sound/Dungeon Theme.*"),init:function(){this.font.letterSpacing=-2,ig.input.bind(ig.KEY.LEFT_ARROW,"left"),ig.input.bind(ig.KEY.RIGHT_ARROW,"right"),ig.input.bind(ig.GAMEPAD.PAD_LEFT,"left"),ig.input.bind(ig.GAMEPAD.PAD_RIGHT,"right"),this.map=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];for(var t=8;t<18;t++)this.map[t]=this.getRow();this.collisionMap=new ig.CollisionMap(70,this.map),this.backgroundMaps.push(new ig.BackgroundMap(70,this.map,"media/mushroom/tiles.png")),this.player=this.spawnEntity(EntityPlayer,ig.system.width/2-2,16),window.myTouchButtons&&window.myTouchButtons.align()},resurrect:function(){this.map.push(this.getRow()),this.player.pos.x=ig.system.width/2-2,this.player.pos.y=16},getRow:function(){for(var t=[],i=0;i<20;i++)t[i]=Math.random()>.93?1:0;return t},placeCoin:function(){for(var t=0;t<20;t++){var i=(70*Math.random()).ceil();if(this.map[this.map.length-1][i]&&!this.map[this.map.length-2][i]){var e=70*(this.map.length-1),s=70*i+1;return void this.spawnEntity(EntityCoin,s,e)}}},update:function(){if(this.gameOver&&(ig.input.pressed("left")||ig.input.pressed("right")||ig.input.pressed("pause")||ig.input.pressed("jump"))&&ig.system.setGame(monsterGame),ig.input.pressed("pause")&&(this.gamePaused?this.gamePaused=!1:this.gamePaused=!0),!this.gameOver&&!this.gamePaused){if(this.speed+=ig.system.tick*(10/this.speed),this.screen.y+=ig.system.tick*this.speed,this.score+=ig.system.tick*this.speed/4,this.screen.y>70){this.screen.y-=70;for(var t=0;t<this.entities.length;t++)this.entities[t].pos.y-=70;this.map.shift(),this.map.push(this.getRow()),Math.random()>.1&&this.placeCoin()}this.parent();var i=this.player.pos.y-this.screen.y;if(i>ig.system.height+70||i<-70){if(this.player.coins>0){for(t=0;t<7;t++)this.map[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.map[6]=[0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0],this.resurrect(),this.player.coins--}else this.highscore=ig.Webstorage.get("highscore"),this.score>this.highscore&&(this.highscore=ig.Webstorage.set("highscore",this.score.floor())),this.gameOver=!0;navigator.vibrate&&navigator.vibrate([100,10,500]),this.gameOverSound.play()}var e=this.getEntitiesByType(EntityPlayer)[0];e&&(this.screen.x=e.pos.x-ig.system.width/2)}},draw:function(){if(this.backdrop.draw(),this.gameOver)this.font.draw("Game Over!",ig.system.width/2,ig.system.height/2-100,ig.Font.ALIGN.CENTER),this.font.draw("score "+this.score.floor()+" : highscore "+this.highscore.floor(),ig.system.width/2,ig.system.height/2-50,ig.Font.ALIGN.CENTER),this.font.draw(ig.ua.mobile?"Press Any Button":"Press Enter",ig.system.width/2,ig.system.height/2,ig.Font.ALIGN.CENTER),this.font.draw("to Restart !",ig.system.width/2,ig.system.height/2+50,ig.Font.ALIGN.CENTER);else if(this.gamePaused)this.font.draw("Game Paused!",ig.system.width/2,ig.system.height/2-100,ig.Font.ALIGN.CENTER),this.font.draw("score "+this.score.floor()+" : highscore "+this.highscore.floor(),ig.system.width/2,ig.system.height/2-50,ig.Font.ALIGN.CENTER),this.font.draw(ig.ua.mobile?"Press Any Button":"Press Enter",ig.system.width/2,ig.system.height/2,ig.Font.ALIGN.CENTER),this.font.draw("to Resume !",ig.system.width/2,ig.system.height/2+50,ig.Font.ALIGN.CENTER);else{if(this.parent(),window.gameStarted||(this.font.draw("freeFall Game!",ig.system.width/2,ig.system.height/2-100,ig.Font.ALIGN.CENTER),this.font.draw(" highscore "+this.highscore.floor(),ig.system.width/2,ig.system.height/2-50,ig.Font.ALIGN.CENTER),this.font.draw(ig.ua.mobile?"Press Any Button":"Press Enter",ig.system.width/2,ig.system.height/2,ig.Font.ALIGN.CENTER),this.font.draw("to start !",ig.system.width/2,ig.system.height/2+50,ig.Font.ALIGN.CENTER)),window.myTouchButtons&&window.myTouchButtons.draw(),this.player){for(var t=16,i=0;i<this.player.maxHealth;i++)this.player.coins>i?this.heartFull.draw(t,16):this.heartEmpty.draw(t,16),t+=this.heartEmpty.width+8;t+=48,this.coinIcon.drawTile(t,22,0,36),t+=42,this.font.draw("x "+this.player.coins,t,26)}this.font.draw(this.score.floor().toString(),ig.system.width-16,16,ig.Font.ALIGN.RIGHT)}}}),mainGame=monsterGame.extend({update:function(){(ig.input.pressed("left")||ig.input.pressed("right")||ig.input.pressed("pause")||ig.input.pressed("jump"))&&(this.music.loop=!0,this.music.volume=.5,this.music.play(),window.gameStarted=!0,ig.system.setGame(monsterGame))}}),ig.ua.mobile){var t=new ig.Image("media/controls.png");myTouchButtons=new ig.TouchButtonCollection([new ig.TouchButton("left",{left:16,bottom:16},100,100,t,0),new ig.TouchButton("right",{left:144,bottom:16},100,100,t,1),new ig.TouchButton("pause",{right:144,bottom:16},100,100,t,17),new ig.TouchButton("jump",{right:16,bottom:112},100,100,t,2)])}var i=window.innerWidth<640?2:1,e=document.getElementById("canvas");e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",window.addEventListener("resize",function(){ig.system&&(e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",ig.system.resize(window.innerWidth*i,window.innerHeight*i),ig.game&&ig.game.setupCamera&&ig.game.setupCamera(),window.myTouchButtons&&window.myTouchButtons.align())},!1),window.innerWidth,window.innerHeight});